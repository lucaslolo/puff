<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <style>
    .stock::before {
      content: "Stock: ";
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Admin Panel - Update Stock</h1>

  <form id="adminForm">
    <label>Watermelon:</label>
    <input type="number" id="watermelon" value="0"><br>

    <label>Blueberry:</label>
    <input type="number" id="blueberry" value="0"><br>

    <label>Blackberry:</label>
    <input type="number" id="blackberry" value="0"><br>

    <label>Strawberry:</label>
    <input type="number" id="strawberry" value="0"><br>

    <label>Triple Melon:</label>
    <input type="number" id="triplemelon" value="0"><br>

    <button type="submit">Update Stock</button>
  </form>

  <h2>Current Stock</h2>
  <p class="stock" id="stock-watermelon">0</p>
  <p class="stock" id="stock-blueberry">0</p>
  <p class="stock" id="stock-blackberry">0</p>
  <p class="stock" id="stock-strawberry">0</p>
  <p class="stock" id="stock-triplemelon">0</p>

  <script>
    const form = document.getElementById('adminForm');

    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const newStock = {
        watermelon: parseInt(document.getElementById('watermelon').value),
        blueberry: parseInt(document.getElementById('blueberry').value),
        blackberry: parseInt(document.getElementById('blackberry').value),
        strawberry: parseInt(document.getElementById('strawberry').value),
        triplemelon: parseInt(document.getElementById('triplemelon').value)
      };

      fetch('/.netlify/functions/update-stock', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(newStock)
      })
      .then(res => res.json())
      .then(data => {
        alert("Stock updated successfully!");

        // Met à jour l'affichage du stock
        document.getElementById('stock-watermelon').textContent = newStock.watermelon;
        document.getElementById('stock-blueberry').textContent = newStock.blueberry;
        document.getElementById('stock-blackberry').textContent = newStock.blackberry;
        document.getElementById('stock-strawberry').textContent = newStock.strawberry;
        document.getElementById('stock-triplemelon').textContent = newStock.triplemelon;

        // Réinitialise les champs à 0
        document.getElementById('watermelon').value = 0;
        document.getElementById('blueberry').value = 0;
        document.getElementById('blackberry').value = 0;
        document.getElementById('strawberry').value = 0;
        document.getElementById('triplemelon').value = 0;
      })
      .catch(err => console.error(err));
    });

    // Charger le stock actuel au chargement de la page
    window.addEventListener('DOMContentLoaded', () => {
      fetch('/.netlify/functions/get-stock')
        .then(res => res.json())
        .then(data => {
          document.getElementById('watermelon').value = data.watermelon;
          document.getElementById('blueberry').value = data.blueberry;
          document.getElementById('blackberry').value = data.blackberry;
          document.getElementById('strawberry').value = data.strawberry;
          document.getElementById('triplemelon').value = data.triplemelon;

          document.getElementById('stock-watermelon').textContent = data.watermelon;
          document.getElementById('stock-blueberry').textContent = data.blueberry;
          document.getElementById('stock-blackberry').textContent = data.blackberry;
          document.getElementById('stock-strawberry').textContent = data.strawberry;
          document.getElementById('stock-triplemelon').textContent = data.triplemelon;
        });
    });
  </script>
</body>
</html>
